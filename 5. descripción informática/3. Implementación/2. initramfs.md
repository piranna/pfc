### initramfs

La segunda capa del sistema es la encargada de montar el sistema de archivos de
los usuarios y crear un sistema de archivos raiz independiente para cada uno de
ellos. Tambien proporciona un ejecutable ```/init``` PID 1 minimo
([century](https://github.com/piranna/node-century)), cuya labor es únicamente
servir de "red de seguridad" de los procesos que mueran en el sistema para
evitar que provoquen un Kernel Panic, delegando el resto de tareas de un proceso
*init* tipico como por ejemplo el funcionar como demonio del sistema para que la
realicen otros comandos que le proporcione el usuario, o en su defecto en el
ejecutable ubicado en ```/sbin/init``` (ubicación tradicional del script de
arranque en los sistemas UNIX). Este enfoque tambien ha sido tenido en cuenta
[por otras personas](http://ewontfix.com/14) en especial debido a la polemica
que rodea a [SystemD](http://www.freedesktop.org/wiki/Software/systemd) y su
diseño centralizando todos los componentes basicos de administracion de los
sistemas Linux mas populares, y a raiz de esto estan surgiendo otros comandos
*init* del sistema minimalistas como [uinit](https://github.com/siblynx/uinit).

El montaje del sistema de archivos de los usuarios es realizado por el módulo
[nodeos-mount-filesystems](../../../8. apéndices/2. módulos/1. módulos propios/8. nodeos-mount-filesystems.md),
el cual es ejecutado en NodeOS por *century* como script de inicio por defecto
al estar apuntando `/sbin/init` a el, y tambien realiza algunas tareas basicas
del arranque del sistema como es el definir el umask del sistema de forma que
los nuevos archivos solo sean accesibles por su creador (*0066*) o la
eliminación de los modulos, archivos y ejecutables usados durante el arranque
del propio initramfs para ahorrar memoria puesto que ya no seran necesarios.

#### nodeos-mount-utils

Para facilitar el montaje de los sistemas de archivos y el manejo de los puntos
de montaje, tambien he desarrollado el modulo
[nodeos-mount-utils](https://github.com/NodeOS/nodeos-mount-utils). Las
funciones que aporta son:

* *execInit*: ejecuta el script de inicio de un usuario. Para ello por seguridad
  se comprueba que tanto el script como el directorio de usuario tienen el mismo
  UID y GID que seran utilizados para definir el UID y GID del proceso, el cual
  se ejecutara en su propia jaula *chroot* utilizando el propio directirio del
  como sistema de archivos raiz
* *mkdirMount*: monta el sistema de archivos, creando el directorio del punto de
  montaje previamente si no existia. Puesto que no importan los permisos del
  directorio que se utilice como punto de montaje para poder ser usado, este se
  crea con modo *0000* para evitar el que se puedan escribir archivos dentro por
  accidente una vez se haya desmontado el sistema de archivos
* *mountfs*: comprueba si el sistema se esta ejecutando en un entorno Docker (ya
  que no usa montaje de particiones sino apilamiento de containers LXC), y si no
  es el caso, monta el sistema de archivos a partir de nombre de la variable de
  entorno indicada usando la funcion *mkdirMount*. Para comprobar si se esta
  ejecutando en un entorno Docker se comprueba la existencia del archivo
  `.dockerinit` en el directorio raiz
* *mountfs_path*: igual a *mountfs* pero usando directamente la ruta al
  dispositivo en vez de una variable de entorno
* *move*: mueve un sistema de archivos a una nueva ubicacion, y si el directorio
  del anterior punto de montaje esta vacio, lo elimina
* *moveSync*: version sincrona de *move*
* *mkdirMove*: igual a *move*, pero creando previamente el directorio del punto
  de montaje destino si no existe
* *startRepl*: crea un interprete REPL de emergencia y termina el proceso desde
  el que se ha lanzado cuando se sale de este
